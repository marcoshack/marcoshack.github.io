---           
layout: post
title: Monitoração da JVM via JMX e SNMP
image: coffee.jpg
date: 2012-05-30 23:05:56 UTC
updated: 2012-05-30 23:05:56 UTC
categories: [ sysadmin ]
tags: [ java, monitoração ]
---

<div style="text-align: justify;">Este post apresenta de forma sucinta os passos necessários para configuração dos agentes JMX e SNMP na Máquina Virtual Java (<em>JVM</em>) assim como exemplos de utilização das ferramentas&nbsp;<em>jconsole</em>&nbsp;e&nbsp;<em>snmpwalk</em>&nbsp;para monitoração. Esse conteúdo é baseado na <a href="http://download.oracle.com/javase/1.5.0/docs/guide/management/" target="_blank">documentação de gerenciamento da JDK Sun/Oracle</a>.</div><br /><div id="headertabs"><div><div id="Configura.C3.A7.C3.A3o"><div style="text-align: justify;">A instalação padrão da JRE/JDK possui um modelo dos arquivos&nbsp;<em>management.properties</em>&nbsp;e&nbsp;<em>snmp.acl</em>&nbsp;com todas as configurações disponíveis (ambos em&nbsp;<em>$JAVA_HOME/jre/lib/management/</em>). Para facilitar a leitura e manutenção recomendo criar estes arquivos na estrutura de diretórios da sua aplicação, principalmente porque isso será necessário caso queira monitorar mais de uma JVM na mesma máquina (ver exemplo do&nbsp;Tomcat&nbsp;abaixo).</div><br /><h2 style="text-align: justify;"> snmp.acl</h2><div style="text-align: justify;">Crie o arquivo&nbsp;<em>snmp.acl</em>&nbsp;no local desejado com as linhas abaixo. Tenha em mente que o dono desse arquivo deve ser o mesmo do processo da JVM, a não ser que esteja executando com&nbsp;<em>root</em>&nbsp;que não é recomendável, diga-se de passagem:</div><br /><pre style="padding-left: 30px;">acl = {<br />  {<br />    communities = public, private<br />    access = read-only<br />    managers = 0.0.0.0/0<br />  }<br />}</pre><br /><div style="text-align: justify;">altere as permissões do mesmo para&nbsp;<em>600</em>&nbsp;(leitura e escrita apenas para o dono):</div><br /><pre style="padding-left: 30px;">chmod 600 &lt;CAMINHO_ARQUIVO_SNMP_ACL&gt;</pre><br /><h2> management.properties</h2><span style="text-align: justify;">Crie o arquivo&nbsp;</span><em style="text-align: justify;">management.properties</em><span style="text-align: justify;">&nbsp;no local desejado e insira as linha a seguir. Neste exemplo utilizamos as portas 9998 e 9999 para os agentes SNMP e JMX consecutivamente. Não esqueça de substituir&nbsp;</span><em style="text-align: justify;">&lt;CAMINHO_ARQUIVO_SNMP_ACL&gt;</em><span style="text-align: justify;">&nbsp;pelo caminho absoluto do arquivo&nbsp;</span><em style="text-align: justify;">snmp.acl</em><span style="text-align: justify;">:</span><br /><br /><pre style="padding-left: 30px;">com.sun.management.jmxremote.port=9999<br />com.sun.management.jmxremote.authenticate=false<br />com.sun.management.jmxremote.ssl=false<br />com.sun.management.snmp.port=9998<br />com.sun.management.snmp.interface=0.0.0.0<br />com.sun.management.snmp.acl.file=&lt;CAMINHO_ARQUIVO_SNMP_ACL&gt;</pre><br /><h2> Inicialização da JVM</h2><span style="text-align: justify;">Adicione o seguinte parâmetro na inicialização da JVM:</span><br /><br /><pre style="padding-left: 30px;">-Dcom.sun.management.config.file=&lt;CAMINHO_ARQUIVO_MANAGEMENT_PROPERTIES&gt;</pre><br /><h2 style="text-align: justify;"> Tomcat</h2><span style="text-align: justify;">Sugiro o seguinte padrão para a configuração dos agentes no Tomcat:</span><br /><ul style="text-align: justify;"><li>Crie os arquivos&nbsp;<em>management.properties</em>&nbsp;e&nbsp;<em>snmp.acl</em>&nbsp;no diretório&nbsp;<em>$CATALINA_BASE/conf</em>.</li></ul><ul style="text-align: justify;"><li>Crie ou edite o arquivo&nbsp;<em>$CATALINA_HOME/bin/setenv.sh</em>&nbsp;e adicione a linha a seguir. O script&nbsp;<em>catalina.sh</em>&nbsp;carrega esse arquivo na inicialização caso exista: <dl><dd><pre>CATALINA_OPTS="$CATALINA_OPTS -Dcom.sun.management.config.file=&lt;CAMINHO_MANAGEMENT_PROPERTIES&gt;"</pre><br /></dd></dl></li></ul></div></div></div>